# Улучшенный обработчик JSON для API языковых моделей

## Обзор проекта

Данный проект представляет собой улучшенный обработчик JSON для обработки ответов от API языковых моделей (Gemini, Mistral, Claude и др.) при генерации языковых курсов. Обработчик способен обрабатывать различные форматы данных, исправлять ошибки в JSON и преобразовывать результаты к единой структуре.

## Основные возможности

- Обработка различных форматов JSON из API языковых моделей
- Извлечение структуры курса из неполных или поврежденных ответов
- Стандартизация формата данных для использования в приложении
- Подробное логирование для отладки и мониторинга
- Восстановление данных из обрезанных ответов API

## Поддерживаемые форматы данных

1. **Стандартный формат курса** - с полями `name`, `description` и массивом `lessons`
2. **Отдельный урок** - объект с полем `title` и др.
3. **Массив уроков** - список объектов с полями `title` и др.
4. **Формат "lesson X"** - объект с ключами вида "lesson 1", "lesson 2" и т.д.

## Структура проекта

- `app/services/content/json_extractor.py` - основной модуль обработчика
- `content_generator/course_generator.py` - модуль генерации курсов, использующий обработчик
- `demo_json_extractor.py` - демонстрационный скрипт для тестирования обработчика
- `test_course_generator.py` - тестирование генератора курса с улучшенным обработчиком
- `README_json_extractor.md` - подробная документация по обработчику JSON

## Установка и настройка

### Создание базы данных

База данных PostgreSQL будет автоматически создана с правильной кодировкой UTF8 при первом запуске приложения. Функция `create_database_if_not_exists()` в `app/core/database.py` автоматически:
- Проверит существование базы данных
- Создаст базу данных с кодировкой UTF8, если она не существует
- Настроит правильные параметры локализации

### Настройка переменных окружения

Убедитесь, что в файле `.env` указан правильный пароль базы данных:

```
DATABASE_URL=postgresql://postgres:P8j#Kq2@vL7xZs9$Rt5!@localhost:5432/pldb
```

## Использование

### Базовое использование

```python
from app.services.content.json_extractor import extract_course_from_api_response

# Получаем ответ от API
api_response = "...ответ от API..."

# Обрабатываем ответ и получаем структуру курса
course_data = extract_course_from_api_response(api_response, debug=True)

# Используем полученные данные
print(f"Название курса: {course_data.get('name')}")
print(f"Количество уроков: {len(course_data.get('lessons', []))}")
```

### Запуск демонстрации

```bash
# Демонстрация обработки различных форматов JSON
python demo_json_extractor.py

# Тестирование генератора курса с улучшенным обработчиком
python test_course_generator.py
```

## Интеграция с существующими системами

Обработчик интегрирован с классом `CourseGenerator`, который используется для генерации языковых курсов. Метод `_process_course_response` был обновлен для использования улучшенного обработчика.

## Дополнительная информация

Более подробную информацию можно найти в файле `README_json_extractor.md`, который содержит детальное описание работы обработчика, примеры использования и решение возможных проблем. 