# Оптимизация изображений

В проекте реализована система оптимизации изображений, которая позволяет улучшить производительность загрузки страниц и уменьшить потребление трафика. Система включает в себя несколько компонентов:

1. Сервис оптимизации изображений (`imageOptimizer.ts`)
2. Компонент для оптимизированных изображений (`OptimizedImage.vue`)
3. Директиву для ленивой загрузки изображений (`v-lazy`)
4. CSS стили для ленивой загрузки

## Сервис оптимизации изображений

Сервис `imageOptimizer.ts` предоставляет следующие функции:

- Определение поддержки современных форматов изображений (WebP, AVIF)
- Выбор оптимального формата изображения для текущего браузера
- Генерация оптимизированных URL для изображений
- Создание оптимизированных элементов изображений
- Инициализация оптимизации изображений на странице

### Использование сервиса

```typescript
import { getOptimizedImageUrl, createOptimizedImage } from '@/services/imageOptimizer';

// Получение оптимизированного URL
const optimizedUrl = await getOptimizedImageUrl('https://example.com/image.jpg');

// Создание оптимизированного элемента изображения
const imgElement = await createOptimizedImage('https://example.com/image.jpg', 'Описание изображения', 'my-class');
```

## Компонент OptimizedImage

Компонент `OptimizedImage.vue` предоставляет удобный интерфейс для работы с оптимизированными изображениями. Он включает в себя:

- Автоматическую оптимизацию изображений
- Ленивую загрузку
- Плейсхолдер во время загрузки
- Эффект blur-up для плавного появления изображений
- Обработку ошибок загрузки

### Использование компонента

```vue
<template>
  <OptimizedImage
    src="https://example.com/image.jpg"
    alt="Описание изображения"
    :aspect-ratio="56.25" <!-- 16:9 -->
    :blur-up="true"
    placeholder-src="data:image/svg+xml,..."
  />
</template>
```

### Параметры компонента

| Параметр | Тип | По умолчанию | Описание |
|----------|-----|--------------|----------|
| src | String | - | URL изображения (обязательный) |
| alt | String | '' | Альтернативный текст |
| width | Number/String | null | Ширина изображения |
| height | Number/String | null | Высота изображения |
| aspectRatio | Number | 56.25 | Соотношение сторон (высота/ширина * 100) |
| blurUp | Boolean | true | Включить эффект blur-up |
| placeholderSrc | String | '' | URL для низкокачественного предпросмотра |

## Директива v-lazy

Директива `v-lazy` позволяет легко добавить ленивую загрузку к любому изображению. Она автоматически:

- Откладывает загрузку изображений до момента, когда они попадают в область видимости
- Оптимизирует URL изображений
- Добавляет плейсхолдеры
- Обрабатывает ошибки загрузки

### Использование директивы

```vue
<template>
  <!-- Базовое использование -->
  <img v-lazy="'https://example.com/image.jpg'" alt="Описание" />
  
  <!-- С контейнером для соотношения сторон -->
  <div class="lazy-container" data-ratio="16:9">
    <img v-lazy="'https://example.com/image.jpg'" alt="Описание" class="lazy-blur-up" />
  </div>
  
  <!-- С кастомным плейсхолдером -->
  <img 
    v-lazy="'https://example.com/image.jpg'" 
    alt="Описание" 
    data-placeholder="data:image/svg+xml,..."
  />
</template>
```

## CSS классы для стилизации

Для стилизации ленивой загрузки доступны следующие CSS классы:

- `.lazy-image` - базовый класс для всех ленивых изображений
- `.lazy-loading` - добавляется во время загрузки
- `.lazy-loaded` - добавляется после успешной загрузки
- `.lazy-error` - добавляется при ошибке загрузки
- `.lazy-blur-up` - для эффекта размытия при загрузке
- `.lazy-container` - контейнер с фиксированным соотношением сторон

## Примеры использования

Примеры использования можно найти в компоненте `LazyLoadExample.vue`.

## Рекомендации по использованию

1. Для критических изображений (например, в первом экране) используйте предзагрузку в `index.html`:
   ```html
   <link rel="preload" href="/path/to/image.jpg" as="image" />
   ```

2. Для изображений, которые не видны сразу, используйте директиву `v-lazy` или компонент `OptimizedImage`.

3. Всегда указывайте соотношение сторон для изображений, чтобы избежать смещения контента при загрузке.

4. Используйте низкокачественные предпросмотры (LQIP) для улучшения пользовательского опыта.

5. Для изображений, загружаемых с внешних источников, рассмотрите возможность использования прокси-сервиса для оптимизации (например, Cloudinary, imgix или images.weserv.nl).

## Производительность

Использование системы оптимизации изображений может значительно улучшить производительность загрузки страниц:

- Уменьшение размера изображений на 30-70% при использовании современных форматов
- Снижение нагрузки на сеть благодаря ленивой загрузке
- Улучшение метрик Core Web Vitals (LCP, CLS)
- Улучшение пользовательского опыта благодаря плавной загрузке и предпросмотрам 